<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

    
    
    <title>  Series temporelles avec Keras  </title>

        <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
        <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="site_libs/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="site_libs/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
        <script src="site_libs/navigation-1.1/tabsets.js"></script>
        <link href="site_libs/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
        <script src="site_libs/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
        <link href="site_libs/readthedown-0.1/readthedown.css" rel="stylesheet" />
        <link href="site_libs/readthedown-0.1/readthedown_fonts_embed.css" rel="stylesheet" />
        <script src="site_libs/readthedown-0.1/readthedown.js"></script>
        <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
        <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
    
    
        <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {  background-color: #f8f8f8; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ef2929; } /* Alert */
      code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #c4a000; } /* Attribute */
      code span.bn { color: #0000cf; } /* BaseN */
      code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4e9a06; } /* Char */
      code span.cn { color: #000000; } /* Constant */
      code span.co { color: #8f5902; font-style: italic; } /* Comment */
      code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
      code span.dt { color: #204a87; } /* DataType */
      code span.dv { color: #0000cf; } /* DecVal */
      code span.er { color: #a40000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #0000cf; } /* Float */
      code span.fu { color: #000000; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
      code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
      code span.ot { color: #8f5902; } /* Other */
      code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
      code span.sc { color: #000000; } /* SpecialChar */
      code span.ss { color: #4e9a06; } /* SpecialString */
      code span.st { color: #4e9a06; } /* String */
      code span.va { color: #000000; } /* Variable */
      code span.vs { color: #4e9a06; } /* VerbatimString */
      code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
    </style>
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
         <!-- readthedown start -->   
   <div id="content" data-toggle="wy-nav-shift">
     <nav id="nav-top" role="navigation" aria-label="top navigation">
       <a role="button" href="#" data-toggle="wy-nav-top"><span class="glyphicon glyphicon-menu-hamburger"></span></a>
     </nav>
         
   
      
      <div class="navbar navbar-default  navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">Sebastien Foulle</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li>
        <a href="about.html">
          <span class="fa fa-user fa-lg"></span>
           
          A propos
        </a>
      </li>
      <li>
        <a href="index.html">
          <span class="fa fa-newspaper fa-lg"></span>
           
          Newsletter
        </a>
      </li>
      <li>
        <a href="veille.html">
          <span class="fa fa-thumbtack fa-lg"></span>
           
          A suivre
        </a>
      </li>
      <li>
        <a href="livres.html">
          <span class="fa fa-book fa-lg"></span>
           
          A  lire
        </a>
      </li>
      <li>
        <a href="groups.html">
          <span class="fa fa-users fa-lg"></span>
           
          A frequenter
        </a>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
          <span class="fa fa-file-image fa-lg"></span>
           
          Formats Rmd
           
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu">
          <li>
            <a href="preambule.html">Preambule</a>
          </li>
          <li class="dropdown-header">--- html document ---</li>
          <li>
            <a href="htmldoc_default.html">default</a>
          </li>
          <li>
            <a href="htmldoc_cerulean.html">cerulean</a>
          </li>
          <li>
            <a href="htmldoc_journal.html">journal</a>
          </li>
          <li>
            <a href="htmldoc_flatly.html">flatly</a>
          </li>
          <li>
            <a href="htmldoc_darkly.html">darkly</a>
          </li>
          <li>
            <a href="htmldoc_readable.html">readable</a>
          </li>
          <li>
            <a href="htmldoc_spacelab.html">spacelab</a>
          </li>
          <li>
            <a href="htmldoc_united.html">united</a>
          </li>
          <li>
            <a href="htmldoc_cosmo.html">cosmo</a>
          </li>
          <li>
            <a href="htmldoc_lumen.html">lumen</a>
          </li>
          <li>
            <a href="htmldoc_paper.html">paper</a>
          </li>
          <li>
            <a href="htmldoc_sandstone.html">sandstone</a>
          </li>
          <li>
            <a href="htmldoc_simplex.html">simplex</a>
          </li>
          <li>
            <a href="htmldoc_yeti.html">yeti</a>
          </li>
          <li class="dropdown-header">--- rmdformats ---</li>
          <li>
            <a href="rmdformats_material.html">material</a>
          </li>
          <li>
            <a href="rmdformats_readthedown.html">readthedown</a>
          </li>
          <li>
            <a href="rmdformats_html_clean.html">html_clean</a>
          </li>
          <li>
            <a href="rmdformats_html_docco.html">html_docco</a>
          </li>
          <li>
            <a href="rmdformats_robobook.html">robobook</a>
          </li>
          <li>
            <a href="rmdformats_downcute.html">downcute</a>
          </li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
          <span class="fa fa-file-image fa-lg"></span>
           
          Rmd legers
           
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu">
          <li class="dropdown-header">--- prettydoc ---</li>
          <li>
            <a href="htmlpretty_cayman.html">cayman</a>
          </li>
          <li>
            <a href="htmlpretty_tactile.html">tactile</a>
          </li>
          <li>
            <a href="htmlpretty_architect.html">architect</a>
          </li>
          <li>
            <a href="htmlpretty_leonids.html">leonids</a>
          </li>
          <li>
            <a href="htmlpretty_hpstr.html">hpstr</a>
          </li>
        </ul>
      </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li>
        <a href="https://www.linkedin.com/in/sebastienfoulle">
          <span class="fa fa-linkedin fa-lg"></span>
           
        </a>
      </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container -->
      </div><!--/.navbar -->
        
      <h1 class="title"> <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:60px;width:52.5px;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> Series temporelles avec <em>Keras</em> <br></h1>
      
         <!-- readthedown authors -->
   <div id="sidebar">
    <h2><a href="#content"> <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:60px;width:52.5px;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> Series temporelles avec <em>Keras</em> <br></a></h2>
    <div id="toc">
      <ul>
      <li><a href="#modules-et-donnees"><span class="toc-section-number">1</span> Modules et donnees</a>
      <ul>
      <li><a href="#modules"><span class="toc-section-number">1.1</span> Modules</a></li>
      <li><a href="#description-des-donnees-airline-passenger"><span class="toc-section-number">1.2</span> Description des donnees Airline Passenger</a></li>
      </ul></li>
      <li><a href="#modelisation-par-tendance-et-saisonnalite"><span class="toc-section-number">2</span> Modelisation par tendance et saisonnalite</a>
      <ul>
      <li><a href="#modele-lineaire"><span class="toc-section-number">2.1</span> Modele lineaire</a></li>
      <li><a href="#qualite-du-modele"><span class="toc-section-number">2.2</span> Qualite du modele</a></li>
      </ul></li>
      <li><a href="#prevision-du-mois-suivant-par-modeles-neuronaux"><span class="toc-section-number">3</span> Prevision du mois suivant par modeles neuronaux</a>
      <ul>
      <li><a href="#early-stopping-et-graphiques-de-performance"><span class="toc-section-number">3.1</span> Early stopping et graphiques de performance</a></li>
      <li><a href="#preparation-des-donnees"><span class="toc-section-number">3.2</span> Preparation des donnees</a>
      <ul>
      <li><a href="#modele-lineaire-et-couche-dense"><span class="toc-section-number">3.2.1</span> Modele lineaire et couche Dense</a></li>
      <li><a href="#couches-recurrentes-et-convolutives"><span class="toc-section-number">3.2.2</span> Couches Recurrentes et Convolutives</a></li>
      </ul></li>
      <li><a href="#architecture-et-entrainement-des-modeles"><span class="toc-section-number">3.3</span> Architecture et entrainement des modeles</a>
      <ul>
      <li><a href="#regression"><span class="toc-section-number">3.3.1</span> Regression</a></li>
      <li><a href="#couche-dense"><span class="toc-section-number">3.3.2</span> Couche Dense</a></li>
      <li><a href="#rnn"><span class="toc-section-number">3.3.3</span> RNN</a></li>
      <li><a href="#gru"><span class="toc-section-number">3.3.4</span> GRU</a></li>
      <li><a href="#tcn"><span class="toc-section-number">3.3.5</span> TCN</a></li>
      </ul></li>
      <li><a href="#performance-lors-de-lentrainement"><span class="toc-section-number">3.4</span> Performance lors de l’entrainement</a>
      <ul>
      <li><a href="#couche-dense-1"><span class="toc-section-number">3.4.1</span> Couche Dense</a></li>
      <li><a href="#rnn-1"><span class="toc-section-number">3.4.2</span> RNN</a></li>
      <li><a href="#gru-1"><span class="toc-section-number">3.4.3</span> GRU</a></li>
      <li><a href="#tcn-1"><span class="toc-section-number">3.4.4</span> TCN</a></li>
      </ul></li>
      <li><a href="#qualite-de-la-prevision-sur-lechantillon-test"><span class="toc-section-number">3.5</span> Qualite de la prevision sur l’echantillon test</a>
      <ul>
      <li><a href="#regression-1"><span class="toc-section-number">3.5.1</span> Regression</a></li>
      <li><a href="#couche-dense-2"><span class="toc-section-number">3.5.2</span> Couche Dense</a></li>
      <li><a href="#rnn-2"><span class="toc-section-number">3.5.3</span> RNN</a></li>
      <li><a href="#gru-2"><span class="toc-section-number">3.5.4</span> GRU</a></li>
      <li><a href="#tcn-2"><span class="toc-section-number">3.5.5</span> TCN</a></li>
      </ul></li>
      </ul></li>
      <li><a href="#prevision-en-bloc-des-l-mois-suivants"><span class="toc-section-number">4</span> Prevision en bloc des <em>L </em>mois suivants</a>
      <ul>
      <li><a href="#preparation-des-donnees-1"><span class="toc-section-number">4.1</span> Preparation des donnees</a>
      <ul>
      <li><a href="#couche-dense-3"><span class="toc-section-number">4.1.1</span> Couche Dense</a></li>
      <li><a href="#couches-recurrentes"><span class="toc-section-number">4.1.2</span> Couches Recurrentes</a></li>
      </ul></li>
      <li><a href="#architecture-et-entrainement-des-modeles-1"><span class="toc-section-number">4.2</span> Architecture et entrainement des modeles</a>
      <ul>
      <li><a href="#couche-dense-4"><span class="toc-section-number">4.2.1</span> Couche Dense</a></li>
      <li><a href="#rnn-3"><span class="toc-section-number">4.2.2</span> RNN</a></li>
      <li><a href="#gru-3"><span class="toc-section-number">4.2.3</span> GRU</a></li>
      <li><a href="#tcn-3"><span class="toc-section-number">4.2.4</span> TCN</a></li>
      </ul></li>
      <li><a href="#performance-lors-de-lentrainement-1"><span class="toc-section-number">4.3</span> Performance lors de l’entrainement</a>
      <ul>
      <li><a href="#couche-dense-5"><span class="toc-section-number">4.3.1</span> Couche Dense</a></li>
      <li><a href="#rnn-4"><span class="toc-section-number">4.3.2</span> RNN</a></li>
      <li><a href="#gru-4"><span class="toc-section-number">4.3.3</span> GRU</a></li>
      <li><a href="#tcn-4"><span class="toc-section-number">4.3.4</span> TCN</a></li>
      </ul></li>
      <li><a href="#qualite-de-la-prevision-sur-lannee-1960"><span class="toc-section-number">4.4</span> Qualite de la prevision sur l’annee 1960</a>
      <ul>
      <li><a href="#couche-dense-6"><span class="toc-section-number">4.4.1</span> Couche Dense</a></li>
      <li><a href="#rnn-5"><span class="toc-section-number">4.4.2</span> RNN</a></li>
      <li><a href="#gru-5"><span class="toc-section-number">4.4.3</span> GRU</a></li>
      <li><a href="#tcn-5"><span class="toc-section-number">4.4.4</span> TCN</a></li>
      </ul></li>
      </ul></li>
      <li><a href="#prevision-iteree-des-l-mois-suivants"><span class="toc-section-number">5</span> Prevision iteree des L mois suivants</a>
      <ul>
      <li><a href="#calcul-des-previsions"><span class="toc-section-number">5.1</span> Calcul des previsions</a>
      <ul>
      <li><a href="#regression-2"><span class="toc-section-number">5.1.1</span> Regression</a></li>
      <li><a href="#couche-dense-7"><span class="toc-section-number">5.1.2</span> Couche Dense</a></li>
      <li><a href="#rnn-6"><span class="toc-section-number">5.1.3</span> RNN</a></li>
      <li><a href="#gru-6"><span class="toc-section-number">5.1.4</span> GRU</a></li>
      <li><a href="#tcn-6"><span class="toc-section-number">5.1.5</span> TCN</a></li>
      </ul></li>
      <li><a href="#qualite-de-la-prevision-sur-lannee-1960-1"><span class="toc-section-number">5.2</span> Qualite de la prevision sur l’annee 1960</a>
      <ul>
      <li><a href="#regression-3"><span class="toc-section-number">5.2.1</span> Regression</a></li>
      <li><a href="#couche-dense-8"><span class="toc-section-number">5.2.2</span> Couche Dense</a></li>
      <li><a href="#rnn-7"><span class="toc-section-number">5.2.3</span> RNN</a></li>
      <li><a href="#gru-7"><span class="toc-section-number">5.2.4</span> GRU</a></li>
      <li><a href="#tcn-7"><span class="toc-section-number">5.2.5</span> TCN</a></li>
      </ul></li>
      </ul></li>
      </ul>
    </div>
    <div id="postamble" data-toggle="wy-nav-shift" class="status">
                </div>
   </div>
     

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<div id="main">
<style>
.r{background-color:lightgrey !important;}
</style>
<p>On teste ici differentes modelisations a base de reseaux neuronaux sous TensorFlow et on les compare a des modeles de regression classiques.</p>
<div id="modules-et-donnees" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Modules et donnees</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;reticulate&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="at">condaenv =</span> <span class="st">&quot;env_tf26&quot;</span>)</span></code></pre></div>
<div id="modules" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Modules</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">&#39;display.max_columns&#39;</span>, <span class="va">None</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.layers <span class="im">import</span> Dense, GRU, Dropout, SimpleRNN</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> EarlyStopping</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/philipperemy/keras-tcn</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tcn <span class="im">import</span> TCN</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># pour regler un bug graphique assez courant avec Anaconda, </span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># adapter le chemin vers le dossier &#39;plugins/platforms&#39;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> os <span class="im">import</span> path</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">&#39;QT_QPA_PLATFORM_PLUGIN_PATH&#39;</span>] <span class="op">=</span> <span class="st">&#39;C:/Users/Sebastien/Anaconda3/Library/plugins/platforms&#39;</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">&quot;.&quot;</span>)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>tf.random.set_seed(<span class="dv">2021</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># calcul de la rmse</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmse(u,v):</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">int</span>(mean_squared_error(u,v)<span class="op">**</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>)</span></code></pre></div>
<p>Les versions Python et TensorFlow utilisees.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sys.version</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>tf.__version__</span></code></pre></div>
<pre><code>&#39;3.9.6 (default, Jul 30 2021, 11:42:22) [MSC v.1916 64 bit (AMD64)]&#39;
&#39;2.6.0&#39;</code></pre>
</div>
<div id="description-des-donnees-airline-passenger" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Description des donnees Airline Passenger</h2>
<p>Il s’agit du nombre mensuel de passagers du secteur aerien de 1949 a 1960, donnees qu’on a deja utilise pour tester le module <em>prophet</em> dans un autre document.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>donnees_r <span class="ot">=</span> <span class="fu">data.frame</span>(AirPassengers)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>donnees_r[<span class="st">&quot;Month&quot;</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">sapply</span>(<span class="dv">1949</span><span class="sc">:</span><span class="dv">1960</span>, \(x) <span class="fu">paste</span>(x, month.abb)))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>donnees_r[<span class="st">&quot;Passengers&quot;</span>] <span class="ot">=</span> donnees_r<span class="sc">$</span>AirPassengers</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>donnees_r<span class="sc">$</span>AirPassengers <span class="ot">=</span> <span class="cn">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>donnees <span class="op">=</span> r.donnees_r</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>donnees.head()</span></code></pre></div>
<pre><code>      Month  Passengers
0  1949 Jan       112.0
1  1949 Feb       118.0
2  1949 Mar       132.0
3  1949 Apr       129.0
4  1949 May       121.0</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>donnees.rename(columns <span class="op">=</span> {<span class="st">&#39;Passengers&#39;</span>:<span class="st">&#39;X&#39;</span>}, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>donnees.X <span class="op">=</span> donnees.X.astype(<span class="st">&#39;float32&#39;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>donnees.reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
<pre><code>        Month      X
0    1949 Jan  112.0
1    1949 Feb  118.0
2    1949 Mar  132.0
3    1949 Apr  129.0
4    1949 May  121.0
..        ...    ...
139  1960 Aug  606.0
140  1960 Sep  508.0
141  1960 Oct  461.0
142  1960 Nov  390.0
143  1960 Dec  432.0

[144 rows x 2 columns]</code></pre>
<p>La serie est multiplicative avec une saisonnalite de periode 12 et la tendance est lineaire par morceaux.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>periode <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>decomposition <span class="op">=</span> sm.tsa.seasonal_decompose(donnees.X, model<span class="op">=</span><span class="st">&#39;multiplicative&#39;</span>, period <span class="op">=</span> <span class="dv">12</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>decomposition.plot()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-5-1.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="modelisation-par-tendance-et-saisonnalite" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Modelisation par tendance et saisonnalite</h1>
<p>On definit une colonne “partition” pour scinder les donnees en jeux d’apprentissage (<code>donnees.partition == True</code>) et de test, l’apprentissage allant jusqu’a mars 1956.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>donnees[<span class="st">&quot;partition&quot;</span>] <span class="op">=</span> pd.Series(donnees.index) <span class="op">&lt;=</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="bu">len</span>(donnees)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>donnees[<span class="st">&quot;partition&quot;</span>].value_counts()</span></code></pre></div>
<pre><code>True     87
False    57
Name: partition, dtype: int64</code></pre>
<div id="modele-lineaire" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Modele lineaire</h2>
<p>On se place d’avril 1953 a mars 1956, soit les 3 dernieres annees de l’apprentissage, pour obtenir une tendance par moyenne mobile et une saisonnalite les plus fiables afin de realiser une prevision par regression lineaire.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X = tendance * saisonnalite * bruit</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># profondeur de calcul de la tendance a partir des donnees recentes de l&#39;apprentissage</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">12</span> <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>dtf <span class="op">=</span> donnees[donnees.partition].copy()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>dtf <span class="op">=</span> dtf[<span class="op">-</span>K:]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>decomposition <span class="op">=</span> sm.tsa.seasonal_decompose(dtf.X, model<span class="op">=</span><span class="st">&#39;multiplicative&#39;</span>, period <span class="op">=</span> periode)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>dtf[<span class="st">&quot;temps&quot;</span>] <span class="op">=</span> <span class="bu">list</span>(dtf.index)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>dtf[<span class="st">&quot;tendance&quot;</span>] <span class="op">=</span> decomposition.trend</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>dtf</span></code></pre></div>
<pre><code>       Month      X  partition  temps    tendance
51  1953 Apr  235.0       True     51         NaN
52  1953 May  229.0       True     52         NaN
53  1953 Jun  243.0       True     53         NaN
54  1953 Jul  264.0       True     54         NaN
55  1953 Aug  272.0       True     55         NaN
56  1953 Sep  237.0       True     56         NaN
57  1953 Oct  211.0       True     57  224.583333
58  1953 Nov  180.0       True     58  224.458333
59  1953 Dec  201.0       True     59  225.541667
60  1954 Jan  204.0       True     60  228.000000
61  1954 Feb  188.0       True     61  230.458333
62  1954 Mar  235.0       True     62  232.250000
63  1954 Apr  227.0       True     63  233.916667
64  1954 May  234.0       True     64  235.625000
65  1954 Jun  264.0       True     65  237.750000
66  1954 Jul  302.0       True     66  240.500000
67  1954 Aug  293.0       True     67  243.958333
68  1954 Sep  259.0       True     68  247.166667
69  1954 Oct  229.0       True     69  250.250000
70  1954 Nov  203.0       True     70  253.500000
71  1954 Dec  229.0       True     71  257.125000
72  1955 Jan  242.0       True     72  261.833333
73  1955 Feb  233.0       True     73  266.666667
74  1955 Mar  267.0       True     74  271.125000
75  1955 Apr  269.0       True     75  275.208333
76  1955 May  270.0       True     76  278.500000
77  1955 Jun  315.0       True     77  281.958333
78  1955 Jul  364.0       True     78  285.750000
79  1955 Aug  347.0       True     79  289.333333
80  1955 Sep  312.0       True     80  293.250000
81  1955 Oct  274.0       True     81         NaN
82  1955 Nov  237.0       True     82         NaN
83  1955 Dec  278.0       True     83         NaN
84  1956 Jan  284.0       True     84         NaN
85  1956 Feb  277.0       True     85         NaN
86  1956 Mar  317.0       True     86         NaN</code></pre>
<p>On modelise lineairement la tendance et on recupere la saisonnalite calculee par <em>statsmodels</em>, ce qui permet d’en deduire la serie residuelle.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>debut_saison <span class="op">=</span> (dtf.temps.<span class="bu">min</span>() <span class="op">//</span> periode <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> periode</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>saisons <span class="op">=</span> <span class="bu">list</span>(decomposition.seasonal.loc[debut_saison:(debut_saison <span class="op">+</span> periode <span class="op">-</span> <span class="dv">1</span>)])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>repet_saisons <span class="op">=</span> <span class="bu">len</span>(donnees) <span class="op">//</span> periode <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>dtf.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> LinearRegression()<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>reg.fit(dtf[[<span class="st">&quot;temps&quot;</span>]], dtf.tendance)<span class="op">;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>donnees[<span class="st">&quot;tendance&quot;</span>] <span class="op">=</span> reg.predict(pd.Series(<span class="bu">range</span>(<span class="bu">len</span>(donnees))).to_frame())</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>donnees[<span class="st">&quot;saisons&quot;</span>] <span class="op">=</span> (saisons<span class="op">*</span>repet_saisons)[:<span class="bu">len</span>(donnees)]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>donnees[<span class="st">&quot;residus&quot;</span>] <span class="op">=</span> donnees.X <span class="op">/</span> donnees.tendance <span class="op">/</span> donnees.saisons</span></code></pre></div>
</div>
<div id="qualite-du-modele" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Qualite du modele</h2>
<p>La tendance lineaire, les residus et la serie de donnees complete, on voit qu’avant avril 1953 la tendance avait une pente differente.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>donnees[[<span class="st">&quot;X&quot;</span>, <span class="st">&quot;tendance&quot;</span>]].plot()<span class="op">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-9-3.png" width="90%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>donnees[[<span class="st">&quot;residus&quot;</span>, <span class="st">&quot;saisons&quot;</span>]].plot()<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-10-5.png" width="90%" style="display: block; margin: auto;" /></p>
<p>On prevoit les 57 valeurs du futur en une fois par une modelisation parametrique simple.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>donnees[<span class="st">&quot;prev&quot;</span>] <span class="op">=</span> donnees.tendance <span class="op">*</span> donnees.saisons</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> <span class="op">~</span>donnees.partition</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>donnees.loc[test, [<span class="st">&quot;X&quot;</span>, <span class="st">&quot;prev&quot;</span>]].plot()<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(donnees.prev[test], donnees.X[test])<span class="sc">}</span><span class="ss">&quot;</span>)<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-11-7.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="prevision-du-mois-suivant-par-modeles-neuronaux" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Prevision du mois suivant par modeles neuronaux</h1>
<p>On va proceder de deux manieres a partir de la connaissance des <em>K</em> derniers mois :</p>
<ul>
<li>par regression lineaire et par couche Dense appliquees a <em>K</em> variables (on peut utiliser tout modele de regression de Machine Learning)</li>
<li>par couches récurrentes RNN et GRU et par couche de convolution TCN</li>
</ul>
<p>On choisit <code>K = 12</code>.</p>
<div id="early-stopping-et-graphiques-de-performance" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Early stopping et graphiques de performance</h2>
<p>Si la perte ne diminue plus sur l’echantillon de validation “val_loss” lors d’une succession de 50 epoques, l’entrainement s’arrete et revient a la meilleure perte observee.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>early_stopping <span class="op">=</span> EarlyStopping(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    monitor <span class="op">=</span> <span class="st">&#39;val_loss&#39;</span>, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    verbose <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    patience <span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    restore_best_weights <span class="op">=</span> <span class="va">True</span>)</span></code></pre></div>
<p>Graphiques qui permettent de detecter le surapprentissage du modele (courbe de perte pour la validation superieure a celle de l’apprentissage) et l’evolution de la metrique “metier”, ici la <em>rmse</em>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> perf(histoire):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  dtf <span class="op">=</span> pd.DataFrame(histoire.history)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  colonnes <span class="op">=</span> dtf.columns</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  dtf <span class="op">=</span> dtf.reset_index().rename(columns <span class="op">=</span> {<span class="st">&#39;index&#39;</span>: <span class="st">&#39;epochs&#39;</span>})</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  dtf_tr <span class="op">=</span> pd.melt(dtf, id_vars <span class="op">=</span> [<span class="st">&#39;epochs&#39;</span>], value_vars <span class="op">=</span> colonnes, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span><span class="st">&#39;noms_col&#39;</span>, value_name<span class="op">=</span><span class="st">&#39;valeurs_col&#39;</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  dtf_tr[<span class="st">&quot;metrique&quot;</span>] <span class="op">=</span> dtf_tr.noms_col.<span class="bu">str</span>.replace(<span class="st">&quot;^val_&quot;</span>, <span class="st">&quot;&quot;</span>, regex <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  dtf_tr[<span class="st">&quot;echantillon&quot;</span>] <span class="op">=</span> <span class="st">&quot;val&quot;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  dtf_tr.loc[dtf_tr.noms_col <span class="op">==</span> dtf_tr.metrique, <span class="st">&quot;echantillon&quot;</span>] <span class="op">=</span> <span class="st">&quot;train&quot;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  g <span class="op">=</span> sns.FacetGrid(dtf_tr, col<span class="op">=</span><span class="st">&quot;metrique&quot;</span>, hue <span class="op">=</span> <span class="st">&quot;echantillon&quot;</span>, sharey <span class="op">=</span> <span class="va">False</span>, col_wrap <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  g <span class="op">=</span> g.map_dataframe(sns.lineplot, x <span class="op">=</span> <span class="st">&quot;epochs&quot;</span>,y <span class="op">=</span> <span class="st">&quot;valeurs_col&quot;</span>).add_legend()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  axes <span class="op">=</span> g.axes</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  axes[<span class="dv">0</span>].set_ylim(<span class="dv">0</span>,<span class="dv">10000</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  axes[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>,<span class="dv">150</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  plt.show()</span></code></pre></div>
</div>
<div id="preparation-des-donnees" class="section level2 tabset tabset-pills" number="3.2">
<h2 class="tabset tabset-pills"><span class="header-section-number">3.2</span> Preparation des donnees</h2>
<div id="modele-lineaire-et-couche-dense" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Modele lineaire et couche Dense</h3>
<p>On cree les <em>K</em> colonnes des mois precedents.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>donnees.drop(columns <span class="op">=</span> <span class="st">&quot;prev&quot;</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dtf_Xcol <span class="op">=</span> donnees.copy()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  dtf_Xcol[<span class="st">&quot;X&quot;</span><span class="op">+</span><span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>)] <span class="op">=</span>dtf_Xcol.X.shift(<span class="op">-</span>i<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>dtf_Xcol[<span class="st">&quot;Y&quot;</span>] <span class="op">=</span> dtf_Xcol.X.shift(<span class="op">-</span>K)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>dtf_Xcol.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>colonnes <span class="op">=</span> [<span class="st">&quot;X&quot;</span>] <span class="op">+</span> [<span class="st">&quot;X&quot;</span><span class="op">+</span><span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> dtf_Xcol.loc[dtf_Xcol.partition, <span class="st">&quot;Y&quot;</span>]</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>train_dense <span class="op">=</span> dtf_Xcol.loc[dtf_Xcol.partition, colonnes]</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>test_dense <span class="op">=</span> dtf_Xcol.loc[<span class="op">~</span>dtf_Xcol.partition, colonnes]</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>dtf_Xcol</span></code></pre></div>
<pre><code>        Month      X  partition    tendance   saisons   residus     X1     X2  \
0    1949 Jan  112.0       True   36.816081  0.912383  3.334289  118.0  132.0   
1    1949 Feb  118.0       True   39.970048  0.847441  3.483678  132.0  129.0   
2    1949 Mar  132.0       True   43.124016  1.001484  3.056404  129.0  121.0   
3    1949 Apr  129.0       True   46.277983  0.977029  2.853038  121.0  135.0   
4    1949 May  121.0       True   49.431950  0.984408  2.486580  135.0  148.0   
..        ...    ...        ...         ...       ...       ...    ...    ...   
127  1959 Aug  559.0      False  437.369940  1.203979  1.061559  463.0  407.0   
128  1959 Sep  463.0      False  440.523907  1.059261  0.992221  407.0  362.0   
129  1959 Oct  407.0      False  443.677874  0.930246  0.986117  362.0  405.0   
130  1959 Nov  362.0      False  446.831842  0.803905  1.007766  405.0  417.0   
131  1959 Dec  405.0      False  449.985809  0.893732  1.007045  417.0  391.0   

        X3     X4     X5     X6     X7     X8     X9    X10    X11      Y  
0    129.0  121.0  135.0  148.0  148.0  136.0  119.0  104.0  118.0  115.0  
1    121.0  135.0  148.0  148.0  136.0  119.0  104.0  118.0  115.0  126.0  
2    135.0  148.0  148.0  136.0  119.0  104.0  118.0  115.0  126.0  141.0  
3    148.0  148.0  136.0  119.0  104.0  118.0  115.0  126.0  141.0  135.0  
4    148.0  136.0  119.0  104.0  118.0  115.0  126.0  141.0  135.0  125.0  
..     ...    ...    ...    ...    ...    ...    ...    ...    ...    ...  
127  362.0  405.0  417.0  391.0  419.0  461.0  472.0  535.0  622.0  606.0  
128  405.0  417.0  391.0  419.0  461.0  472.0  535.0  622.0  606.0  508.0  
129  417.0  391.0  419.0  461.0  472.0  535.0  622.0  606.0  508.0  461.0  
130  391.0  419.0  461.0  472.0  535.0  622.0  606.0  508.0  461.0  390.0  
131  419.0  461.0  472.0  535.0  622.0  606.0  508.0  461.0  390.0  432.0  

[132 rows x 18 columns]</code></pre>
</div>
<div id="couches-recurrentes-et-convolutives" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Couches Recurrentes et Convolutives</h3>
<p>On compile les <em>K</em> colonnes en une colonne de listes et on met le tenseur a la bonne dimension : nombre d’echantillons * historique de profondeur <em>K</em> * dimension de chaque valeur (1 pour notre serie univariee).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dtf_Xlist <span class="op">=</span> dtf_Xcol.copy()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>dtf_Xlist[<span class="st">&quot;val_prec&quot;</span>] <span class="op">=</span> dtf_Xlist[colonnes].values.tolist()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>dtf_Xlist.drop(columns <span class="op">=</span> colonnes, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> <span class="bu">list</span>(dtf_Xlist.loc[dtf_Xlist.partition, <span class="st">&quot;val_prec&quot;</span>])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> <span class="bu">list</span>(dtf_Xlist.loc[<span class="op">~</span>dtf_Xlist.partition, <span class="st">&quot;val_prec&quot;</span>])</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> np.reshape(X_train, (<span class="bu">len</span>(X_train), K, <span class="dv">1</span>))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> np.reshape(X_test, (<span class="bu">len</span>(X_test), K, <span class="dv">1</span>))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>dtf_Xlist[[<span class="st">&quot;val_prec&quot;</span>, <span class="st">&quot;Y&quot;</span>]]</span></code></pre></div>
<pre><code>                                              val_prec      Y
0    [112.0, 118.0, 132.0, 129.0, 121.0, 135.0, 148...  115.0
1    [118.0, 132.0, 129.0, 121.0, 135.0, 148.0, 148...  126.0
2    [132.0, 129.0, 121.0, 135.0, 148.0, 148.0, 136...  141.0
3    [129.0, 121.0, 135.0, 148.0, 148.0, 136.0, 119...  135.0
4    [121.0, 135.0, 148.0, 148.0, 136.0, 119.0, 104...  125.0
..                                                 ...    ...
127  [559.0, 463.0, 407.0, 362.0, 405.0, 417.0, 391...  606.0
128  [463.0, 407.0, 362.0, 405.0, 417.0, 391.0, 419...  508.0
129  [407.0, 362.0, 405.0, 417.0, 391.0, 419.0, 461...  461.0
130  [362.0, 405.0, 417.0, 391.0, 419.0, 461.0, 472...  390.0
131  [405.0, 417.0, 391.0, 419.0, 461.0, 472.0, 535...  432.0

[132 rows x 2 columns]</code></pre>
</div>
</div>
<div id="architecture-et-entrainement-des-modeles" class="section level2 tabset tabset-pills" number="3.3">
<h2 class="tabset tabset-pills"><span class="header-section-number">3.3</span> Architecture et entrainement des modeles</h2>
<div id="regression" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Regression</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model_lin <span class="op">=</span> LinearRegression()<span class="op">;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>model_lin.fit(train_dense, Y_train)<span class="op">;</span></span></code></pre></div>
</div>
<div id="couche-dense" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Couche Dense</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model_dense <span class="op">=</span> Sequential()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>model_dense.add(Dense(<span class="dv">100</span>, input_dim <span class="op">=</span> <span class="bu">len</span>(colonnes)))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>model_dense.add(Dense(<span class="dv">1</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>model_dense.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>history_dense <span class="op">=</span> model_dense.fit(train_dense, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">100</span>, </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
</div>
<div id="rnn" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> RNN</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model_rnn <span class="op">=</span> Sequential()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>model_rnn.add(SimpleRNN(<span class="dv">256</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, input_shape <span class="op">=</span> (K, <span class="dv">1</span>)))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>model_rnn.add(Dropout(<span class="fl">0.2</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>model_rnn.add(Dense(<span class="dv">1</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>model_rnn.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>history_rnn <span class="op">=</span> model_rnn.fit(X_train,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">300</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
<pre><code>Restoring model weights from the end of the best epoch.
Epoch 00287: early stopping</code></pre>
</div>
<div id="gru" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> GRU</h3>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model_gru <span class="op">=</span> Sequential()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>model_gru.add(GRU(<span class="dv">256</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, input_shape <span class="op">=</span> (K, <span class="dv">1</span>)))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>model_gru.add(Dropout(<span class="fl">0.2</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>model_gru.add(Dense(<span class="dv">1</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>model_gru.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>history_gru <span class="op">=</span> model_gru.fit(X_train,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">200</span>, </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
</div>
<div id="tcn" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> TCN</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>tcn_layer <span class="op">=</span> TCN(input_shape <span class="op">=</span> (K, <span class="dv">1</span>),</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                nb_filters <span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                kernel_size <span class="op">=</span> <span class="dv">12</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                dilations <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Receptive field size =&#39;</span>, tcn_layer.receptive_field)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>model_tcn <span class="op">=</span> Sequential()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>model_tcn.add(tcn_layer)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>model_tcn.add(Dropout(<span class="fl">0.2</span>))</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>model_tcn.add(Dense(<span class="dv">1</span>))</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>model_tcn.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>history_tcn <span class="op">=</span> model_tcn.fit(X_train,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">300</span>, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
<pre><code>Receptive field size = 67
Restoring model weights from the end of the best epoch.
Epoch 00164: early stopping</code></pre>
</div>
</div>
<div id="performance-lors-de-lentrainement" class="section level2 tabset tabset-pills" number="3.4">
<h2 class="tabset tabset-pills"><span class="header-section-number">3.4</span> Performance lors de l’entrainement</h2>
<div id="couche-dense-1" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Couche Dense</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>perf(history_dense)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-17-9.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="rnn-1" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> RNN</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>perf(history_rnn)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-18-11.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="gru-1" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> GRU</h3>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>perf(history_gru)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-19-13.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="tcn-1" class="section level3" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> TCN</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>perf(history_tcn)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-20-15.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="qualite-de-la-prevision-sur-lechantillon-test" class="section level2 tabset tabset-pills" number="3.5">
<h2 class="tabset tabset-pills"><span class="header-section-number">3.5</span> Qualite de la prevision sur l’echantillon test</h2>
<div id="regression-1" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Regression</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dtf_Xcol[<span class="st">&quot;prev&quot;</span>] <span class="op">=</span> model_lin.predict(dtf_Xcol[colonnes])<span class="op">;</span> test <span class="op">=</span> <span class="op">~</span>dtf_Xcol.partition</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>dtf_Xcol.loc[test, [<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;prev&quot;</span>]].plot()<span class="op">;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(dtf_Xcol.prev[test], dtf_Xcol.Y[test])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-21-17.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="couche-dense-2" class="section level3" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Couche Dense</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>dtf_Xcol[<span class="st">&quot;prev&quot;</span>] <span class="op">=</span> model_dense.predict(dtf_Xcol[colonnes])<span class="op">;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>dtf_Xcol.loc[test, [<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;prev&quot;</span>]].plot()<span class="op">;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(dtf_Xcol.prev[test], dtf_Xcol.Y[test])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-22-19.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="rnn-2" class="section level3" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> RNN</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># on applique tf.convert_to_tensor pour eviter des warnings</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.concatenate((X_train, X_test))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>dtf_Xlist[<span class="st">&quot;prev&quot;</span>] <span class="op">=</span> model_rnn.predict(X)<span class="op">;</span> test <span class="op">=</span> <span class="op">~</span>dtf_Xlist.partition</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>dtf_Xlist.loc[test, [<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;prev&quot;</span>]].plot()<span class="op">;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(dtf_Xlist.prev[test], dtf_Xlist.Y[test])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-23-21.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="gru-2" class="section level3" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> GRU</h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dtf_Xlist[<span class="st">&quot;prev&quot;</span>] <span class="op">=</span> model_gru.predict(X)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>dtf_Xlist.loc[test, [<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;prev&quot;</span>]].plot()<span class="op">;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(dtf_Xlist.prev[test], dtf_Xlist.Y[test])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-24-23.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="tcn-2" class="section level3" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> TCN</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dtf_Xlist[<span class="st">&quot;prev&quot;</span>] <span class="op">=</span> model_tcn.predict(X)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>dtf_Xlist.loc[test, [<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;prev&quot;</span>]].plot()<span class="op">;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(dtf_Xlist.prev[test], dtf_Xlist.Y[test])<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-25-25.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="prevision-en-bloc-des-l-mois-suivants" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Prevision en bloc des <em>L </em>mois suivants</h1>
<p>On choisit <code>L = 12</code>.</p>
<div id="preparation-des-donnees-1" class="section level2 tabset tabset-pills" number="4.1">
<h2 class="tabset tabset-pills"><span class="header-section-number">4.1</span> Preparation des donnees</h2>
<p>On prepare les donnees selon le meme schema que plus haut, avec <em>L</em> colonnes cibles au lieu d’une.</p>
<div id="couche-dense-3" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Couche Dense</h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dtf_Xcol <span class="op">=</span> donnees.copy()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  dtf_Xcol[<span class="st">&quot;X&quot;</span><span class="op">+</span><span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>)] <span class="op">=</span>dtf_Xcol.X.shift(<span class="op">-</span>i<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  dtf_Xcol[<span class="st">&quot;Y&quot;</span><span class="op">+</span><span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>)] <span class="op">=</span>dtf_Xcol.X.shift(<span class="op">-</span>K<span class="op">-</span>i)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>dtf_Xcol.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>colonnesY <span class="op">=</span> [<span class="st">&quot;Y&quot;</span><span class="op">+</span><span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L)]</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>Y_train <span class="op">=</span> dtf_Xcol.loc[dtf_Xcol.partition, colonnesY].values</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>dtf_Xcol.drop(columns <span class="op">=</span> colonnesY, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>colonnes <span class="op">=</span> [<span class="st">&quot;X&quot;</span>] <span class="op">+</span> [<span class="st">&quot;X&quot;</span><span class="op">+</span><span class="bu">str</span>(i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(K<span class="op">-</span><span class="dv">1</span>)]</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>train_dense <span class="op">=</span> dtf_Xcol.loc[dtf_Xcol.partition, colonnes]</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>test_dense <span class="op">=</span> dtf_Xcol.loc[<span class="op">~</span>dtf_Xcol.partition, colonnes]</span></code></pre></div>
</div>
<div id="couches-recurrentes" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Couches Recurrentes</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dtf_Xlist <span class="op">=</span> dtf_Xcol.copy()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>dtf_Xlist[<span class="st">&quot;val_prec&quot;</span>] <span class="op">=</span> dtf_Xlist[colonnes].values.tolist()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>dtf_Xlist.drop(columns <span class="op">=</span> colonnes, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> <span class="bu">list</span>(dtf_Xlist.loc[dtf_Xlist.partition, <span class="st">&quot;val_prec&quot;</span>])</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> <span class="bu">list</span>(dtf_Xlist.loc[<span class="op">~</span>dtf_Xlist.partition, <span class="st">&quot;val_prec&quot;</span>])</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> np.reshape(X_train, (<span class="bu">len</span>(X_train), K, <span class="dv">1</span>))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> np.reshape(X_test, (<span class="bu">len</span>(X_test), K, <span class="dv">1</span>))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>dtf_Xlist</span></code></pre></div>
<pre><code>        Month  partition    tendance   saisons   residus  \
0    1949 Jan       True   36.816081  0.912383  3.334289   
1    1949 Feb       True   39.970048  0.847441  3.483678   
2    1949 Mar       True   43.124016  1.001484  3.056404   
3    1949 Apr       True   46.277983  0.977029  2.853038   
4    1949 May       True   49.431950  0.984408  2.486580   
..        ...        ...         ...       ...       ...   
116  1958 Sep      False  402.676298  1.059261  0.947158   
117  1958 Oct      False  405.830266  0.930246  0.950938   
118  1958 Nov      False  408.984233  0.803905  0.942867   
119  1958 Dec      False  412.138200  0.893732  0.914913   
120  1959 Jan      False  415.292168  0.912383  0.950105   

                                              val_prec  
0    [112.0, 118.0, 132.0, 129.0, 121.0, 135.0, 148...  
1    [118.0, 132.0, 129.0, 121.0, 135.0, 148.0, 148...  
2    [132.0, 129.0, 121.0, 135.0, 148.0, 148.0, 136...  
3    [129.0, 121.0, 135.0, 148.0, 148.0, 136.0, 119...  
4    [121.0, 135.0, 148.0, 148.0, 136.0, 119.0, 104...  
..                                                 ...  
116  [404.0, 359.0, 310.0, 337.0, 360.0, 342.0, 406...  
117  [359.0, 310.0, 337.0, 360.0, 342.0, 406.0, 396...  
118  [310.0, 337.0, 360.0, 342.0, 406.0, 396.0, 420...  
119  [337.0, 360.0, 342.0, 406.0, 396.0, 420.0, 472...  
120  [360.0, 342.0, 406.0, 396.0, 420.0, 472.0, 548...  

[121 rows x 6 columns]</code></pre>
</div>
</div>
<div id="architecture-et-entrainement-des-modeles-1" class="section level2 tabset tabset-pills" number="4.2">
<h2 class="tabset tabset-pills"><span class="header-section-number">4.2</span> Architecture et entrainement des modeles</h2>
<div id="couche-dense-4" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Couche Dense</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>model_dense2 <span class="op">=</span> Sequential()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>model_dense2.add(Dense(<span class="dv">100</span>, input_dim <span class="op">=</span> <span class="bu">len</span>(colonnes)))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>model_dense2.add(Dense(L))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>model_dense2.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>history_dense <span class="op">=</span> model_dense2.fit(train_dense, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">100</span>, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
</div>
<div id="rnn-3" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> RNN</h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model_rnn2 <span class="op">=</span> Sequential()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>model_rnn2.add(SimpleRNN(<span class="dv">260</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, input_shape <span class="op">=</span> (K, <span class="dv">1</span>)))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>model_rnn2.add(Dropout(<span class="fl">0.2</span>))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>model_rnn2.add(Dense(L))</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>model_rnn2.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>history_rnn <span class="op">=</span> model_rnn2.fit(X_train,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">300</span>, </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
</div>
<div id="gru-3" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> GRU</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>model_gru2 <span class="op">=</span> Sequential()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>model_gru2.add(GRU(<span class="dv">256</span>, activation<span class="op">=</span><span class="st">&#39;relu&#39;</span>, input_shape <span class="op">=</span> (K, <span class="dv">1</span>)))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>model_gru2.add(Dropout(<span class="fl">0.2</span>))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>model_gru2.add(Dense(L))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>model_gru2.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>history_gru <span class="op">=</span> model_gru2.fit(X_train,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">300</span>, </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
</div>
<div id="tcn-3" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> TCN</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>tcn_layer <span class="op">=</span> TCN(input_shape <span class="op">=</span> (K, <span class="dv">1</span>),</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>                nb_filters <span class="op">=</span> <span class="dv">30</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                kernel_size <span class="op">=</span> <span class="dv">3</span>,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                dilations <span class="op">=</span> (<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Receptive field size =&#39;</span>, tcn_layer.receptive_field)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>model_tcn2 <span class="op">=</span> Sequential()</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>model_tcn2.add(tcn_layer)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>model_tcn2.add(Dropout(<span class="fl">0.2</span>))</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>model_tcn2.add(Dense(L))</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>model_tcn2.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;mean_squared_error&quot;</span>, metrics <span class="op">=</span> [tf.keras.metrics.RootMeanSquaredError()])</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>history_tcn <span class="op">=</span> model_tcn2.fit(X_train,</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                    Y_train, </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>                    epochs <span class="op">=</span> <span class="dv">300</span>, </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>                    batch_size <span class="op">=</span> <span class="dv">16</span>, </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>                    verbose <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>                    validation_split <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>                    callbacks <span class="op">=</span> [early_stopping])</span></code></pre></div>
<pre><code>Receptive field size = 13</code></pre>
</div>
</div>
<div id="performance-lors-de-lentrainement-1" class="section level2 tabset tabset-pills" number="4.3">
<h2 class="tabset tabset-pills"><span class="header-section-number">4.3</span> Performance lors de l’entrainement</h2>
<div id="couche-dense-5" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Couche Dense</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>perf(history_dense)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-29-27.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="rnn-4" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> RNN</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>perf(history_rnn)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-30-29.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="gru-4" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> GRU</h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>perf(history_gru)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-31-31.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="tcn-4" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> TCN</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>perf(history_tcn)</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-32-33.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="qualite-de-la-prevision-sur-lannee-1960" class="section level2 tabset tabset-pills" number="4.4">
<h2 class="tabset tabset-pills"><span class="header-section-number">4.4</span> Qualite de la prevision sur l’annee 1960</h2>
<div id="couche-dense-6" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Couche Dense</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:],</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;prev&quot;</span>: np.squeeze(model_dense2.predict(dtf_Xcol.tail(<span class="dv">1</span>)[colonnes]))})</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-33-35.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="rnn-5" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> RNN</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> np.reshape(X_test[<span class="op">-</span><span class="dv">1</span>,:], (<span class="dv">1</span>,L,<span class="dv">1</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:],</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;prev&quot;</span>: np.squeeze(model_rnn2.predict(test))})</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-34-37.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="gru-5" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> GRU</h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:],</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;prev&quot;</span>: np.squeeze(model_gru2.predict(test))})</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<pre><code>WARNING:tensorflow:5 out of the last 13 calls to &lt;function Model.make_predict_function.&lt;locals&gt;.predict_function at 0x0000000060A8E160&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.</code></pre>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-35-39.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="tcn-5" class="section level3" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> TCN</h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:],</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;prev&quot;</span>: np.squeeze(model_tcn2.predict(test))})</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<pre><code>WARNING:tensorflow:6 out of the last 14 calls to &lt;function Model.make_predict_function.&lt;locals&gt;.predict_function at 0x0000000060B18280&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
C:\Users\SEBAST~1\ANACON~1\envs\env_tf26\lib\site-packages\pandas\plotting\_matplotlib\core.py:345: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`).
  fig = self.plt.figure(figsize=self.figsize)</code></pre>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-36-41.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="prevision-iteree-des-l-mois-suivants" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Prevision iteree des L mois suivants</h1>
<p>On reprend les modeles entraines pour predire la valeur suivante. Cette nouvelle valeur est ensuite consideree comme la derniere valeur connue, et on reapplique les modeles pour predire la valeur qui la suit, etc.</p>
<div id="calcul-des-previsions" class="section level2 tabset tabset-pills" number="5.1">
<h2 class="tabset tabset-pills"><span class="header-section-number">5.1</span> Calcul des previsions</h2>
<div id="regression-2" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Regression</h3>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> dtf_Xcol[colonnes].tail(<span class="dv">1</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>noms <span class="op">=</span> dernieres_valeurs.columns</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  prev <span class="op">=</span> model_lin.predict(dernieres_valeurs)[<span class="dv">0</span>]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  decale_valeurs <span class="op">=</span> dernieres_valeurs.values[<span class="dv">0</span>] .tolist()[<span class="dv">1</span>:]</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  decale_valeurs.append(prev)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  dernieres_valeurs <span class="op">=</span> pd.DataFrame(np.reshape(decale_valeurs, (<span class="dv">1</span>,<span class="dv">12</span>)), columns <span class="op">=</span> noms)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>prev_lin <span class="op">=</span> dernieres_valeurs.values[<span class="dv">0</span>] .tolist()</span></code></pre></div>
</div>
<div id="couche-dense-7" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Couche Dense</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> dtf_Xcol[colonnes].tail(<span class="dv">1</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>noms <span class="op">=</span> dernieres_valeurs.columns</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  prev <span class="op">=</span> model_dense.predict(dernieres_valeurs)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  decale_valeurs <span class="op">=</span> dernieres_valeurs.values[<span class="dv">0</span>] .tolist()[<span class="dv">1</span>:]</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  decale_valeurs.append(prev)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  dernieres_valeurs <span class="op">=</span> pd.DataFrame(np.reshape(decale_valeurs, (<span class="dv">1</span>,<span class="dv">12</span>)), columns <span class="op">=</span> noms)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>prev_dense <span class="op">=</span>  dernieres_valeurs.values[<span class="dv">0</span>] .tolist()</span></code></pre></div>
</div>
<div id="rnn-6" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> RNN</h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> X_test.shape</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> X_test[dims[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>,:,<span class="dv">0</span>]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> np.reshape(dernieres_valeurs, (<span class="dv">1</span>,K,<span class="dv">1</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  prev <span class="op">=</span> model_rnn.predict(dernieres_valeurs)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  decale_valeurs <span class="op">=</span> dernieres_valeurs[<span class="dv">0</span>,:,<span class="dv">0</span>].tolist()[<span class="dv">1</span>:]</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  decale_valeurs.append(prev)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  dernieres_valeurs <span class="op">=</span> np.reshape(decale_valeurs, (<span class="dv">1</span>,K,<span class="dv">1</span>))</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>prev_rnn <span class="op">=</span>  dernieres_valeurs[<span class="dv">0</span>,:,<span class="dv">0</span>].tolist()</span></code></pre></div>
</div>
<div id="gru-6" class="section level3" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> GRU</h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> X_test.shape</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> X_test[dims[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>,:,<span class="dv">0</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> np.reshape(dernieres_valeurs, (<span class="dv">1</span>,K,<span class="dv">1</span>))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  prev <span class="op">=</span> model_gru.predict(dernieres_valeurs)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  decale_valeurs <span class="op">=</span> dernieres_valeurs[<span class="dv">0</span>,:,<span class="dv">0</span>].tolist()[<span class="dv">1</span>:]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  decale_valeurs.append(prev)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  dernieres_valeurs <span class="op">=</span> np.reshape(decale_valeurs, (<span class="dv">1</span>,K,<span class="dv">1</span>))</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>prev_gru <span class="op">=</span> dernieres_valeurs[<span class="dv">0</span>,:,<span class="dv">0</span>].tolist()</span></code></pre></div>
</div>
<div id="tcn-6" class="section level3" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> TCN</h3>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> X_test.shape</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> X_test[dims[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>,:,<span class="dv">0</span>]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>dernieres_valeurs <span class="op">=</span> np.reshape(dernieres_valeurs, (<span class="dv">1</span>,K,<span class="dv">1</span>))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  prev <span class="op">=</span> model_tcn.predict(dernieres_valeurs)[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  decale_valeurs <span class="op">=</span> dernieres_valeurs[<span class="dv">0</span>,:,<span class="dv">0</span>].tolist()[<span class="dv">1</span>:]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  decale_valeurs.append(prev)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  dernieres_valeurs <span class="op">=</span> np.reshape(decale_valeurs, (<span class="dv">1</span>,K,<span class="dv">1</span>))</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>prev_tcn <span class="op">=</span> dernieres_valeurs[<span class="dv">0</span>,:,<span class="dv">0</span>].tolist()</span></code></pre></div>
</div>
</div>
<div id="qualite-de-la-prevision-sur-lannee-1960-1" class="section level2 tabset tabset-pills" number="5.2">
<h2 class="tabset tabset-pills"><span class="header-section-number">5.2</span> Qualite de la prevision sur l’annee 1960</h2>
<div id="regression-3" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Regression</h3>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:], <span class="st">&quot;prev&quot;</span>: prev_lin})</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-42-43.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="couche-dense-8" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Couche Dense</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:], <span class="st">&quot;prev&quot;</span>: prev_dense})</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-43-45.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="rnn-7" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> RNN</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:], <span class="st">&quot;prev&quot;</span>: prev_rnn})</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-44-47.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="gru-7" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> GRU</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:], <span class="st">&quot;prev&quot;</span>: prev_gru})</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-45-49.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
<div id="tcn-7" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> TCN</h3>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>resultats <span class="op">=</span> pd.DataFrame({<span class="st">&quot;reel&quot;</span>: donnees.X[<span class="op">-</span>L:], <span class="st">&quot;prev&quot;</span>: prev_tcn})</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>resultats.plot()<span class="op">;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;rmse = </span><span class="sc">{</span>rmse(resultats.reel, resultats.prev)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>plt.show(ylim <span class="op">=</span> (<span class="dv">300</span>, <span class="dv">650</span>))</span></code></pre></div>
<p><img src="hebdor_series_temp_files/figure-html/unnamed-chunk-46-51.png" width="90%" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
</div>

   
   
            
      

  <script>
    $(document).ready(function () {

			
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
