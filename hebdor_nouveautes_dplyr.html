<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>  Nouveautes de dplyr 1.0.0  </title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

/* A workaround for https://github.com/jgm/pandoc/issues/4278 */
a.sourceLine {
  pointer-events: auto;
}

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link rel="stylesheet" href="hebdor_nouveautes_dplyr_files/style.css" type="text/css" />





</head>

<body>




<section class="page-header">
<h1 class="title toc-ignore project-name"> <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:60px;width:68.09px;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:lightblue;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> Nouveautes de dplyr 1.0.0 <br></h1>
</section>


<div id="TOC" class="toc">
<div class="toc-box">
<h2 id="toc-title" class="toc-title">Table des matieres</h2>
<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#selection-de-variables">Selection de variables</a>
<ul>
<li><a href="#par-type-de-donnees-avec-where">Par type de donnees avec <em>where</em></a></li>
<li><a href="#par-plusieurs-conditions">Par plusieurs conditions</a></li>
<li><a href="#remplacement-du-mal-nomme-one_of">Remplacement du mal-nomme <em>one_of</em></a></li>
<li><a href="#changer-lordre-des-variables-avec-relocate">Changer l’ordre des variables avec <em>relocate</em></a></li>
</ul></li>
<li><a href="#renommer-des-champs-avec-rename_with">Renommer des champs avec <em>rename_with</em></a></li>
<li><a href="#agregats-multiples-avec-summarise">Agregats multiples avec <em>summarise</em></a>
<ul>
<li><a href="#plusieurs-lignes-renvoyees">Plusieurs lignes renvoyees</a></li>
<li><a href="#plusieurs-lignes-et-colonnes-renvoyees">Plusieurs lignes et colonnes renvoyees</a></li>
</ul></li>
<li><a href="#across-pour-faire-des-calculs-sur-plusieurs-variables-et-fonctions"><em>Across</em> pour faire des calculs sur plusieurs variables et fonctions</a>
<ul>
<li><a href="#avec-summarise">Avec <em>summarise</em></a></li>
<li><a href="#avec-les-autres-operateurs">Avec les autres operateurs</a></li>
</ul></li>
</ul>
</div>
</div>

<section class="main-content">
<div id="intro" class="section level1">
<h1>Introduction</h1>
<p>La nouvelle version de <em>dplyr</em> sera disponible dans quelques jours sur le CRAN et elle est deja testable sur github. Elle apporte des nouveautes et des changements dont les details sont presentes ici :</p>
<ul>
<li><a href="https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-summarise/" class="uri">https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-summarise/</a></li>
<li><a href="https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-select-rename-relocate/" class="uri">https://www.tidyverse.org/blog/2020/03/dplyr-1-0-0-select-rename-relocate/</a></li>
<li><a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/" class="uri">https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/</a></li>
</ul>
<p>Vous trouverez ci-dessous quelques exemples de ces evolutions. La plupart d’entre elles permettent de supprimer des fonctions specifiques (<em>summarise_at</em>, <em>select_if</em>, …) pour les remplacer par une syntaxe plus generale et plus puissante.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># donnees</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tips <span class="ot">=</span> reshape2<span class="sc">::</span>tips[, <span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;smoker&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;size&quot;</span>, <span class="st">&quot;total_bill&quot;</span>, <span class="st">&quot;tip&quot;</span>)]</span></code></pre></div>
</div>
<div id="selection-de-variables" class="section level1">
<h1>Selection de variables</h1>
<div id="par-type-de-donnees-avec-where" class="section level3">
<h3>Par type de donnees avec <em>where</em></h3>
<p>Avant avec <em>select_if</em>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric)</span></code></pre></div>
<pre><code>    size total_bill tip
126    6      29.80 4.2
142    6      34.30 6.7
144    6      27.05 5.0
157    6      48.17 5.0</code></pre>
<p>Apres avec <em>where</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>    size total_bill tip
126    6      29.80 4.2
142    6      34.30 6.7
144    6      27.05 5.0
157    6      48.17 5.0</code></pre>
</div>
<div id="par-plusieurs-conditions" class="section level3">
<h3>Par plusieurs conditions</h3>
<p>Combinaison de criteres avec les operateurs booleens usuels <em>&amp;</em>, <em>|</em>, <em>!</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;t&quot;</span>) <span class="sc">&amp;</span> <span class="fu">ends_with</span>(<span class="st">&quot;l&quot;</span>))</span></code></pre></div>
<pre><code>    total_bill
126      29.80
142      34.30
144      27.05
157      48.17</code></pre>
</div>
<div id="remplacement-du-mal-nomme-one_of" class="section level3">
<h3>Remplacement du mal-nomme <em>one_of</em></h3>
<p>La fonction <em>one_of</em> est renommee <em>any_of</em>, elle permet de selectionner un ensemble de champ en utilisant le vecteur des noms des champs (alors que les fonctions du package <em>dplyr</em> attendent d’habitude des noms de variable sans guillemets).</p>
<p>Un point d’attention : si l’un des champs n’existe pas la fonction <em>one_of</em> ne signale pas d’erreur, alors que sa variante <em>all_of</em> declenchera une erreur, ca peut etre une exigence utile dans une chaine de production.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mes_champs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;day&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;toto&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">any_of</span>(mes_champs))</span></code></pre></div>
<pre><code>     day   time
126 Thur  Lunch
142 Thur  Lunch
144 Thur  Lunch
157  Sun Dinner</code></pre>
</div>
<div id="changer-lordre-des-variables-avec-relocate" class="section level3">
<h3>Changer l’ordre des variables avec <em>relocate</em></h3>
<p>Avant avec <em>everything</em> les possibilites etaient limitees.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(size, tip, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>    size tip    sex smoker  day   time total_bill
126    6 4.2 Female     No Thur  Lunch      29.80
142    6 6.7   Male     No Thur  Lunch      34.30
144    6 5.0 Female     No Thur  Lunch      27.05
157    6 5.0   Male     No  Sun Dinner      48.17</code></pre>
<p>Apres avec <em>relocate</em>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(size, tip)</span></code></pre></div>
<pre><code>    size tip    sex smoker  day   time total_bill
126    6 4.2 Female     No Thur  Lunch      29.80
142    6 6.7   Male     No Thur  Lunch      34.30
144    6 5.0 Female     No Thur  Lunch      27.05
157    6 5.0   Male     No  Sun Dinner      48.17</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>    size total_bill tip    sex smoker  day   time
126    6      29.80 4.2 Female     No Thur  Lunch
142    6      34.30 6.7   Male     No Thur  Lunch
144    6      27.05 5.0 Female     No Thur  Lunch
157    6      48.17 5.0   Male     No  Sun Dinner</code></pre>
</div>
</div>
<div id="renommer-des-champs-avec-rename_with" class="section level1">
<h1>Renommer des champs avec <em>rename_with</em></h1>
<p>Avec cette nouvelle fonction, <em>rename_at</em> et <em>rename_if</em> deviennent obsoletes.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(size <span class="sc">==</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(toupper, <span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>       sex smoker  day   time SIZE TOTAL_BILL TIP
126 Female     No Thur  Lunch    6      29.80 4.2
142   Male     No Thur  Lunch    6      34.30 6.7
144 Female     No Thur  Lunch    6      27.05 5.0
157   Male     No  Sun Dinner    6      48.17 5.0</code></pre>
<p>A noter : dans toutes les versions recentes de <em>dplyr</em> il est possible de renommer des champs dans des operateurs tels que <em>group_by</em>, <em>count</em> et <em>select</em>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="at">mon_groupe =</span> sex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mon_calcul =</span> <span class="fu">mean</span>(size))</span></code></pre></div>
<pre><code># A tibble: 2 x 2
  mon_groupe mon_calcul
  &lt;fct&gt;           &lt;dbl&gt;
1 Female           2.46
2 Male             2.63</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">count</span>(<span class="at">groupe1 =</span> sex, <span class="at">groupe2 =</span> day, <span class="at">name =</span> <span class="st">&quot;frequence&quot;</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>  groupe1 groupe2 frequence
1    Male     Sat        59
2    Male     Sun        58
3  Female    Thur        32
4    Male    Thur        30
5  Female     Sat        28
6  Female     Sun        18
7    Male     Fri        10
8  Female     Fri         9</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">count</span>(sex) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">nb =</span> n, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>   nb    sex
1  87 Female
2 157   Male</code></pre>
</div>
<div id="agregats-multiples-avec-summarise" class="section level1">
<h1>Agregats multiples avec <em>summarise</em></h1>
<p>La fonction d’agregation devient beaucoup plus puissante, ce qui rend inutile le recours a des fonctions comme <em>unnest</em> du package <em>tidyr</em>.</p>
<div id="plusieurs-lignes-renvoyees" class="section level3">
<h3>Plusieurs lignes renvoyees</h3>
<p>Avant pour calculer des quantiles.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">quartiles =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(total_bill))) <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">unnest</span>()</span></code></pre></div>
<pre><code># A tibble: 5 x 1
  quartiles
      &lt;dbl&gt;
1      3.07
2     13.3 
3     17.8 
4     24.1 
5     50.8 </code></pre>
<p>Apres.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">quartiles =</span> <span class="fu">quantile</span>(total_bill))</span></code></pre></div>
<pre><code>  quartiles
1    3.0700
2   13.3475
3   17.7950
4   24.1275
5   50.8100</code></pre>
</div>
<div id="plusieurs-lignes-et-colonnes-renvoyees" class="section level3">
<h3>Plusieurs lignes et colonnes renvoyees</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ma_fonction <span class="ot">=</span> <span class="cf">function</span>(x) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  vecteur_nomme <span class="ot">=</span> <span class="fu">quantile</span>(x)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">valeurs =</span> <span class="fu">unname</span>(vecteur_nomme), <span class="at">seuils =</span> <span class="fu">names</span>(vecteur_nomme))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">quartiles =</span> <span class="fu">ma_fonction</span>(total_bill))</span></code></pre></div>
<pre><code>  quartiles.valeurs quartiles.seuils
1            3.0700               0%
2           13.3475              25%
3           17.7950              50%
4           24.1275              75%
5           50.8100             100%</code></pre>
<p>On peut renommer les champs avec les doubles accolades “curly-curly” deja vues dans un precedent hebdomadR, cf <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/" class="uri">https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/</a>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ma_fonction <span class="ot">=</span> <span class="cf">function</span>(x) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pour que le {{}}:= fonctionne, il faut l&#39;utiliser a la premiere ligne de code,</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sans aucune operation prealable sur x, sinon il &quot;se passe des choses&quot; ...</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># on commence donc par initialiser le dataframe resultat rempli de valeurs par defaut</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  resultat <span class="ot">=</span> <span class="fu">tibble</span>(<span class="st">&quot;{{x}}_valeurs&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">numeric</span>(<span class="dv">5</span>), <span class="st">&quot;{{x}}_seuils&quot;</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">character</span>(<span class="dv">5</span>))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  vecteur_nomme <span class="ot">=</span> <span class="fu">quantile</span>(x)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  resultat[[<span class="dv">1</span>]] <span class="ot">=</span> <span class="fu">unname</span>(vecteur_nomme)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  resultat[[<span class="dv">2</span>]] <span class="ot">=</span> <span class="fu">names</span>(vecteur_nomme)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(resultat)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">ma_fonction</span>(total_bill))</span></code></pre></div>
<pre><code>  total_bill_valeurs total_bill_seuils
1             3.0700                0%
2            13.3475               25%
3            17.7950               50%
4            24.1275               75%
5            50.8100              100%</code></pre>
</div>
</div>
<div id="across-pour-faire-des-calculs-sur-plusieurs-variables-et-fonctions" class="section level1">
<h1><em>Across</em> pour faire des calculs sur plusieurs variables et fonctions</h1>
<p>Ce nouveau mot-cle permet d’appliquer des operateurs tels que <em>summarise</em>, <em>mutate</em>, <em>filter</em> a plusieurs variables et plusieurs fonctions. Les fonctions <em>summarise_if</em>, <em>summarise_at</em> sont desormais inutiles.</p>
<div id="avec-summarise" class="section level3">
<h3>Avec <em>summarise</em></h3>
<p>En utilisant l’ordre des variables dans le dataframe.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(size<span class="sc">:</span>tip, mean))</span></code></pre></div>
<pre><code>      size total_bill      tip
1 2.569672   19.78594 2.998279</code></pre>
<p>En utilisant le type des variables avec <em>where</em>.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean))</span></code></pre></div>
<pre><code>      size total_bill      tip
1 2.569672   19.78594 2.998279</code></pre>
<p>Avec plusieurs fonctions nommees ou pas (dans ce second cas la fonction est designee par un numero …).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span>  <span class="fu">summarise</span>(<span class="fu">across</span>(total_bill<span class="sc">:</span>tip, <span class="fu">list</span>(<span class="at">unique =</span> n_distinct, <span class="at">moy =</span> mean, sum)))</span></code></pre></div>
<pre><code>  total_bill_unique total_bill_moy total_bill_3 tip_unique  tip_moy  tip_3
1               229       19.78594      4827.77        123 2.998279 731.58</code></pre>
<p>Pour controler le nom des colonnes et leur agencement.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(total_bill<span class="sc">:</span>tip, <span class="fu">list</span>(<span class="at">moy=</span>mean, <span class="at">somme=</span>sum), <span class="at">.names =</span> <span class="st">&quot;{fn}.{col}&quot;</span>))</span></code></pre></div>
<pre><code>  moy.total_bill somme.total_bill  moy.tip somme.tip
1       19.78594          4827.77 2.998279    731.58</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(total_bill<span class="sc">:</span>tip, mean, <span class="at">.names =</span> <span class="st">&quot;{col}_moy&quot;</span>),</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">across</span>(total_bill<span class="sc">:</span>tip, sum, <span class="at">.names =</span> <span class="st">&quot;{col}_somme&quot;</span>))</span></code></pre></div>
<pre><code>  total_bill_moy  tip_moy total_bill_somme tip_somme
1       19.78594 2.998279          4827.77    731.58</code></pre>
<p>Avec <em>group_by</em>, plusieurs fonctions dans le <em>across</em> et la fonction de comptage en-dehors.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">n</span>(), <span class="fu">across</span>(total_bill<span class="sc">:</span>tip,<span class="fu">list</span>(<span class="at">sum=</span>sum,<span class="at">mean=</span>mean)))</span></code></pre></div>
<pre><code># A tibble: 2 x 6
  sex       nb total_bill_sum total_bill_mean tip_sum tip_mean
  &lt;fct&gt;  &lt;int&gt;          &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 Female    87          1571.            18.1    247.     2.83
2 Male     157          3257.            20.7    485.     3.09</code></pre>
<p>Note : si le <em>nb = n()</em> precede un <em>across(where(is.numeric))</em>, le <em>across</em> va s’appliquer au champ <em>nb</em>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">n</span>(), <span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sd))</span></code></pre></div>
<pre><code>  nb      size total_bill      tip
1 NA 0.9510998   8.902412 1.383638</code></pre>
<p>On peut eviter ca comme suit.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solution 1 : nb a la fin puis deplace</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sd), <span class="at">nb =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="fu">relocate</span>(nb)</span></code></pre></div>
<pre><code>   nb      size total_bill      tip
1 244 0.9510998   8.902412 1.383638</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solution 2 : on exclut nb du across</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">n</span>(), <span class="fu">across</span>(<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span>nb, sd))</span></code></pre></div>
<pre><code>   nb      size total_bill      tip
1 244 0.9510998   8.902412 1.383638</code></pre>
</div>
<div id="avec-les-autres-operateurs" class="section level3">
<h3>Avec les autres operateurs</h3>
<p>On a les memes possibilites avec</p>
<ul>
<li><em>mutate</em> et <em>filter</em>, voir <a href="https://dplyr.tidyverse.org/dev/articles/colwise.html#other-verbs" class="uri">https://dplyr.tidyverse.org/dev/articles/colwise.html#other-verbs</a></li>
<li>les operateurs <em>distinct</em>, <em>count</em>, <em>group_by</em> mais pour ceux-ci, par construction il n’y a pas de fonction a appliquer, <em>across</em> permet simplement de definir de facon pratique un ensemble de variables auxquelles on applique ces operateurs.</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deduplication</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(<span class="fu">across</span>(smoker<span class="sc">:</span>time))</span></code></pre></div>
<pre><code>    smoker  day   time
1       No  Sun Dinner
20      No  Sat Dinner
57     Yes  Sat Dinner
78      No Thur  Lunch
81     Yes Thur  Lunch
91     Yes  Fri Dinner
92      No  Fri Dinner
165    Yes  Sun Dinner
221    Yes  Fri  Lunch
224     No  Fri  Lunch
244     No Thur Dinner</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table de contingence</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">count</span>(<span class="fu">across</span>(smoker<span class="sc">:</span>time))</span></code></pre></div>
<pre><code>   smoker  day   time  n
1      No  Fri Dinner  3
2      No  Fri  Lunch  1
3      No  Sat Dinner 45
4      No  Sun Dinner 57
5      No Thur Dinner  1
6      No Thur  Lunch 44
7     Yes  Fri Dinner  9
8     Yes  Fri  Lunch  6
9     Yes  Sat Dinner 42
10    Yes  Sun Dinner 19
11    Yes Thur  Lunch 17</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># groupes</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>tips <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(<span class="fu">across</span>(smoker<span class="sc">:</span>time)) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">comptage_distinct =</span> <span class="fu">n_distinct</span>(size))</span></code></pre></div>
<pre><code># A tibble: 11 x 4
# Groups:   smoker, day [8]
   smoker day   time   comptage_distinct
   &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;              &lt;int&gt;
 1 No     Fri   Dinner                 1
 2 No     Fri   Lunch                  1
 3 No     Sat   Dinner                 4
 4 No     Sun   Dinner                 5
 5 No     Thur  Dinner                 1
 6 No     Thur  Lunch                  6
 7 Yes    Fri   Dinner                 2
 8 Yes    Fri   Lunch                  2
 9 Yes    Sat   Dinner                 5
10 Yes    Sun   Dinner                 4
11 Yes    Thur  Lunch                  3</code></pre>
<p><a href="#intro"><strong>retour au debut du document</strong></a></p>
</div>
</div>
</section>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
